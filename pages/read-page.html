<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multilingual Website with Persistence</title>
</head>
<body>
  <!-- Google Translate Widget -->
  <div id="google_translate_element"></div>

  <!-- Your content -->
  <h1 id="greeting">សួស្តី</h1>
  <p id="about">អំពីយើង</p>
  <a href="test.html" id="contact">ទំនាក់ទំនង</a>

  <!-- Google Translate Script -->
  <script type="text/javascript">
    // Initialize Google Translate widget
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'km',
        includedLanguages: 'en', // Only English is available for translation (no Khmer option)
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      }, 'google_translate_element');
    }

    // Function to trigger language change in Google Translate
    function googleTranslateLanguage(lang) {
      var translateElement = document.querySelector('.goog-te-combo');
      if (translateElement) {
        translateElement.value = lang; // Set the value based on selected language
        translateElement.dispatchEvent(new Event('change')); // Trigger the change event
      }
    }

    // Store selected language in localStorage
    function setLanguagePreference(lang) {
      localStorage.setItem('preferredLanguage', lang);
    }

    // Get the stored language from localStorage
    function getLanguagePreference() {
      return localStorage.getItem('preferredLanguage');
    }

    // On page load, apply the stored language preference
    window.onload = function() {
      const savedLang = getLanguagePreference();
      if (savedLang === 'en') {
        // If English is saved, apply translation to English
        googleTranslateLanguage('en');
      } else {
        // If no preference is saved or the default (Khmer), do nothing (no translation)
        googleTranslateLanguage(''); // Empty value triggers no translation
      }
    };

    // Event listener for Google Translate change
    document.addEventListener('change', function(e) {
      if (e.target && e.target.classList.contains('goog-te-combo')) {
        const selectedLanguage = e.target.value;
        setLanguagePreference(selectedLanguage); // Save selected language
        if (selectedLanguage === 'en') {
          googleTranslateLanguage('en'); // Apply translation to English
        } else {
          googleTranslateLanguage(''); // No translation, keep Khmer
        }
      }
    });
  </script>

  <!-- Google Translate Script -->
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
